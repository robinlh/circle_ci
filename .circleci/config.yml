# Use the latest 2.1 version of CircleCI pipeline process engine.
# See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1
workflows:
  test-singularity:
    jobs:
      - test:
          context: dockerhub # has an env var called MY_ENV_VAR
jobs:
  test:
    machine: true
#     working_directory: ~/circle_ci
    steps:
      - checkout
      - run: |
          echo $DOCKERHUB_PASSWORD | docker login --username $DOCKERHUB_USERNAME --password-stdin
          docker pull roblhall/singularity

          docker create -v /sfiles --name singularity_files alpine:3.4 /bin/true

          docker cp ~/circle_ci/test_container/ singularity_files:/sfiles
          docker run --privileged --volumes-from singularity_files roblhall/singularity build python_app.simg python_app.def
#     docker:
#       - image: roblhall/singularity
#         auth:
#           username: $DOCKERHUB_USERNAME
#           password: $DOCKERHUB_PASSWORD
#     steps:
#       - checkout
#       - run: singularity --help
#       - run: singularity build python_app.simg python_app.def
          
#           context: dockerhub # has an env var called MY_ENV_VAR
  

