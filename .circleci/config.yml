# Use the latest 2.1 version of CircleCI pipeline process engine.
# See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1
workflows:
  test-singularity:
    jobs:
      - test:
          context: dockerhub
jobs:
  test:
    machine: true
    steps:
      - checkout
      - run: |
          echo $DOCKERHUB_PASSWORD | docker login --username $DOCKERHUB_USERNAME --password-stdin 
          docker pull roblhall/singularity
          
          docker create -v /sfiles --name singularity_files alpine:3.4 /bin/true
          docker cp test_container/ singularity_files:/sfiles

          docker run --privileged --volumes-from singularity_files roblhall/singularity build /sfiles/test_container/python_app.simg /sfiles/test_container/python_app.def
          docker cp singularity_files:/sfiles/test_container/python_app.simg test_container/

  

